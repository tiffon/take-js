!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.take=t():e.take=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var r=n(11),o=i(r);t.TakeTemplate=o["default"]},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),s=(0,o.charRepeater)(" "),a=(0,o.charRepeater)("^"),u=function(){function e(t,n,r,o,s,a){i(this,e),this.type=t,this.content=n,this.line=r,this.lineNum=o,this.start=s,this.end=a}return r(e,[{key:"toString",value:function(e){return(0,o.dedentOffset)(e,"\n            Token {\n                     type: "+this.type+"\n                  content: "+JSON.stringify(this.content)+"\n                 line num: "+this.lineNum+"\n               start, end: "+this.start+", "+this.end+"\n                     line: "+JSON.stringify(this.line)+"\n                            "+(s(this.start)+a(this.end-this.start))+"\n            }\n        ")}}]),e}();t["default"]=u},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){var n;if(1===t.length)return e[t[0]];var i=t.length-1;for(n=0;i>n;n++)e=e[t[n]];return e[t[n]]}function o(e,t,n){var i,r,o;for(1===t.length&&(e[t[0]]=n),o=0,r=t.length-1;r>o;o++)i=t[o],e=i in e?e[i]:e[i]={};e[t[o]]=n}function s(e){function t(e){var t;if(1>e)return"";if(i>=e)return n.slice(-e);for(t=n+n;t.length<e;)t+=n;return t.slice(-e)}for(var n=""+e,i=64;n.length<i;)n+=n;return t}function a(e,t){var n=(0,f["default"])(t);if(!e)return n;var i=n.split("\n");return e+i.join("\n"+e)}function u(e){var t,n="",i="",r=0;if(Array.isArray(e))t=e;else if(t=e.source,e.format){var o=e.format.split("%s");n=o[0]||"",i=o[1]||""}for(var s=t.length,a={};s>r;r++){var u=t[r];a[u]=n+u+i}return Object.freeze(a)}Object.defineProperty(t,"__esModule",{value:!0}),t.getViaNameList=r,t.saveToNameList=o,t.charRepeater=s,t.dedentOffset=a,t.newConstantsNamespace=u;var l=n(23),f=i(l)},function(e,t){"use strict"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),r=(0,i.newConstantsNamespace)({format:"TokenType{ %s }",source:["CONTEXT","QUERY_STATEMENT","QUERY_STATEMENT_END","CSS_SELECTOR","ACCESSOR_SEQUENCE","INDEX_ACCESSOR","TEXT_ACCESSOR","OWN_TEXT_ACCESSOR","ATTR_ACCESSOR","FIELD_ACCESSOR","DIRECTIVE_STATEMENT","DIRECTIVE_STATEMENT_END","DIRECTIVE_IDENTIFIER","DIRECTIVE_BODY_ITEM","INLINE_SUB_CONTEXT"]});t["default"]=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(17),a=i(s),u=n(6),l=i(u),f=n(13),c=i(f),_=(n(3),n(21)),h=n(1),d=(i(h),n(4)),E=i(d),T=n(19),p=i(T),v=function(){function e(t,n,i,o){r(this,e),this._depth=t,this._tokenGetter=[n],this._defs=i||{},this._fromInline=!!o,this._nodes=[],this._tok=void 0,this._isDone=!1}return o(e,[{key:"getDefs",value:function(){return this._defs}},{key:"getDepth",value:function(){return this._depth}},{key:"destroy",value:function(){}},{key:"parse",value:function(){var e;if(this._isDone)throw new Error("Already parsed.");return e=this._parse(),{node:new p["default"](this._depth,this._nodes),endTok:e}}},{key:"spawnContextParser",value:function(t,n){var i=Object.create(this._defs);if(null==t){if(!this._tok)throw new Error("Invalid state: this._tok cannot be null when spawing ContextParser without a provided depth");t=this._tok.end}return new e(t,this._tokenGetter[0],i,n)}},{key:"nextToken",value:function(e){if(this._tok=this._tokenGetter[0](),!this._tok&&(this._isDone=!0,!e))throw new Error("Unexpected end of input");return this._tok}},{key:"_parse",value:function(){for(var e,t;;){if(e=this.nextToken(),!e)throw new Error("Token expected, found EOF");if(e.type===E["default"].QUERY_STATEMENT)this._parseQuery(),e=void 0;else{if(e.type!==E["default"].DIRECTIVE_STATEMENT)throw new l["default"](e.type,[E["default"].QUERY_STATEMENT,E["default"].DIRECTIVE_STATEMENT],e);e=this._parseDirective()}if(e||(e=this.nextToken(!0)),!e)return;if(e.type!==E["default"].CONTEXT&&e.type!==E["default"].INLINE_SUB_CONTEXT)throw new l["default"](e.type,[E["default"].CONTEXT,E["default"].INLINE_SUB_CONTEXT],e);if(e.type===E["default"].INLINE_SUB_CONTEXT)if(t=this._parseInlineSubContext()){if(t.type!==E["default"].CONTEXT)throw new l["default"](t.type,E["default"].CONTEXT,t);e=t}else if(e=this.nextToken(!0),!e)return;if(e.end>this._depth){if(t=this._parseContext(),!t)return;e=t}if(e.end<this._depth)return e;if(this._fromInline)return e}}},{key:"_parseContext",value:function(){var e=this.spawnContextParser(),t=e.parse();if(e.destroy(),!t.node)throw new Error("Expected to find a sub-context");return this._nodes.push(t.node),t.endTok}},{key:"_parseInlineSubContext",value:function(){var e=this.spawnContextParser(this._depth,!0),t=e.parse();if(e.destroy(),!t.node)throw new Error("Expected to find an inline-sub-context");return this._nodes.push(t.node),t.endTok}},{key:"_parseQuery",value:function(){this._nodes.push((0,_.parse)(this))}},{key:"_parseDirective",value:function(){var e,t,n=this.nextToken();if(!n)throw new Error("Invalid state: this._tok cannot be null when parsing a call to a directive");if(n.type!==E["default"].DIRECTIVE_IDENTIFIER)throw new l["default"](n.type,E["default"].DIRECTIVE_IDENTIFIER,n);if(e=n.content.trim(),c["default"][e])return t=c["default"][e](this),t.node&&this._nodes.push(t.node),t.endTok;if(!this._defs[e])throw new a["default"](e,"Unknown directive: "+JSON.stringify(e),n);this._parseCallUserDirective(this._defs[e])}},{key:"_parseCallUserDirective",value:function(e){var t=this.nextToken();if(!t)throw new Error("Invalid state: this._tok cannot be null when parsing a call to a user-directive");if(t.type!==E["default"].DIRECTIVE_STATEMENT_END)throw new l["default"](t.type,E["default"].DIRECTIVE_STATEMENT_END,t);this._nodes.push(e)}}]),e}();t["default"]=v},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,n,i){this.found=e,this.expected=t,this.token=n,this.message=i,this.stack=Error.call(this,""+this).stack}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),s=(i(o),n(2)),a=n(8);(0,a.configErrorProto)(r,"UnexpectedTokenError"),r.prototype.toString=function(e){return(0,s.dedentOffset)(e,"\n            UnexpectedTokenError {\n                    found: "+this.found+"\n                 expected: "+this.expected+"\n                  message: "+this.message+"\n                    token: "+(this.token?"\n"+this.token.toString("                            "):this.token)+"\n            }\n    ")},t["default"]=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t,n=e.nextToken();if(!n)throw new a["default"]("Expected "+h["default"].DIRECTIVE_BODY_ITEM+" token, found EOF");if(n.type!==h["default"].DIRECTIVE_BODY_ITEM)throw new l["default"](n.type,h["default"].DIRECTIVE_BODY_ITEM,n);if(t=e.nextToken(),!t)throw new a["default"]("Expected "+h["default"].DIRECTIVE_STATEMENT_END+" token, found EOF");if(t.type!==h["default"].DIRECTIVE_STATEMENT_END)throw new l["default"](t.type,h["default"].DIRECTIVE_STATEMENT_END,t);return n}function o(e,t){var n,i,r=e.nextToken();if(!r)throw new a["default"]("Expected "+h["default"].CONTEXT+" token, found EOF");if(r.type!==h["default"].CONTEXT)throw new l["default"](r.type,h["default"].CONTEXT,r);if(r.end<=e.getDepth())throw new a["default"]('Invalid depth, expecting to start a "'+t+'" context.',r);return n=e.spawnContextParser(),i=n.parse(),n.destroy(),i}Object.defineProperty(t,"__esModule",{value:!0}),t.getOneParam=r,t.getSubContext=o;var s=n(9),a=i(s),u=n(6),l=i(u),f=(n(3),n(5)),c=(i(f),n(1)),_=(i(c),n(4)),h=i(_)},function(e,t){"use strict";function n(e,t){e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e.prototype.name=t}Object.defineProperty(t,"__esModule",{value:!0}),t.configErrorProto=n},function(e,t,n){"use strict";function i(e,t){this.message=e,this.extra=t,this.stack=Error.call(this,""+this).stack}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(8);(0,o.configErrorProto)(i,"TakeSyntaxError"),i.prototype.toString=function(e){return(0,r.dedentOffset)(e,"\n            TakeSyntaxError {\n                  message: "+this.message+"\n                    extra: "+this.extra+"\n            }\n    ")},t["default"]=i},function(module,exports){"use strict";"undefined"!=typeof window?module.exports=jQuery:module.exports=eval("require")("cheerio")},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(10),a=i(s),u=n(20),l=i(u),f=function(){function e(t){r(this,e);var n=void 0;if("string"==typeof t)n=t.split("\n");else{if(!Array.isArray(t))throw new Error("Invalid template source");n=t}this.node=(0,l["default"])(n)}return o(e,[{key:"take",value:function(e){var t=(0,a["default"])(e),n={};return this.node.exec(void 0,n,t,t),n}}]),e}();t["default"]=f},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=[],n=e.nextToken();if(!n)throw new u["default"]("The `def` directive requires a parameter for the name");for(;n&&n.type===d["default"].DIRECTIVE_BODY_ITEM;)t.push(n.content.trim()),n=e.nextToken();if(!t.length)throw new u["default"]("The `def` directive requires a parameter for the name",n);if(!n)throw new u["default"]("Expecting a "+d["default"].DIRECTIVE_STATEMENT_END+" token");if(n.type!==d["default"].DIRECTIVE_STATEMENT_END)throw new f["default"](n.type,d["default"].DIRECTIVE_STATEMENT_END,n);var i=(0,E.getSubContext)(e,"def"),r=t.join(" ");if(!i.node)throw new Error("Invalid sub-context for def directive");return e.getDefs()[r]=new T(i.node),{node:void 0,endTok:i.endTok}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.makeDefSubroutine=o;var a=n(9),u=i(a),l=n(6),f=i(l),c=(n(3),n(5)),_=(i(c),n(1)),h=(i(_),n(4)),d=i(h),E=n(7),T=function(){function e(t){r(this,e),this._subCtxNode=t}return s(e,[{key:"exec",value:function(e){if(null==e)throw new Error("Invalid context - def INode must be exececuted on a non-null context");var t={};this._subCtxNode.exec(void 0,t,e.value,e.value),e.lastValue=t}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(12),r=n(14),o=n(16),s=n(15),a=Object.freeze({save:o.makeSave,":":o.makeSave,"save each":s.makeSaveEach,def:i.makeDefSubroutine,namespace:r.makeNamespace,"+":r.makeNamespace});t["default"]=a},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=(0,l.getOneParam)(e),n=t.content.trim().split("."),i=(0,l.getSubContext)(e,"namespace");if(!i.node)throw new Error("Invalid sub-context for namespace directive");return{node:new f(n,i.node),endTok:i.endTok}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.makeNamespace=o;var a=(n(3),n(1)),u=(i(a),n(2)),l=n(7),f=function(){function e(t,n){r(this,e),this._identParts=t,this._subCtxNode=n}return s(e,[{key:"exec",value:function(e){if(null==e)throw new Error('context must not be `== null` for "namespace" directive');var t=(0,u.getViaNameList)(e.rv,this._identParts);null==t&&(t={},(0,u.saveToNameList)(e.rv,this._identParts,t)),this._subCtxNode.exec(void 0,t,e.value,e.value)}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=(0,f.getOneParam)(e),n=t.content.trim().split("."),i=(0,f.getSubContext)(e,"save each");if(!i.node)throw new Error("Invalid sub-context for save-each directive");return{node:new c(n,i.node),endTok:i.endTok}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.makeSaveEach=o;var a=(n(3),n(5)),u=(i(a),n(1)),l=(i(u),n(2)),f=n(7),c=function(){function e(t,n){r(this,e),this._nameParts=t,this._subContext=n}return s(e,[{key:"exec",value:function(e){if(null==e)throw new Error('context must not be `== null` for "save each" directive');var t,n,i,r,o=e.value,s=[],a=0;if((0,l.saveToNameList)(e.rv,this._nameParts,s),null!=o&&o.length)for(t=this._subContext,n=o.length;n>a;a++)i=o[a],r={},s.push(r),t.exec(void 0,r,i,i)}}]),e}()},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=(0,f.getOneParam)(e),n=t.content.trim().split(".");return{node:new c(n),endTok:void 0}}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();t.makeSave=o;var a=(n(3),n(5)),u=(i(a),n(2)),l=n(1),f=(i(l),n(7)),c=function(){function e(t){r(this,e),this._nameParts=t}return s(e,[{key:"exec",value:function(e){if(null==e)throw new Error("Invalid context - save INode must be exececuted on a non-null context");(0,u.saveToNameList)(e.rv,this._nameParts,e.value)}}]),e}()},function(e,t,n){"use strict";function i(e,t,n){this.ident=e,this.message=t,this.extra=n,this.stack=Error.call(this,""+this).stack}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(8);(0,o.configErrorProto)(i,"InvalidDirectiveError"),i.prototype.toString=function(e){return(0,r.dedentOffset)(e,"\n        InvalidDirectiveError {\n                ident: "+JSON.stringify(this.ident)+"\n              message: "+this.message+"\n                extra: "+JSON.stringify(this.extra)+"\n        }\n    ")},t["default"]=i},function(e,t,n){"use strict";function i(e,t,n,i,r){this.message=e,this.line=t,this.lineNum=n,this.pos=i,this.extra=r,this.stack=Error.call(this,""+this).stack}Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(8),s=(0,r.charRepeater)(" ");(0,o.configErrorProto)(i,"ScanError"),i.prototype.toString=function(e){return(0,r.dedentOffset)(e,"\n        ScanError {\n              message: "+this.message+"\n                 line: "+JSON.stringify(this.line)+"\n                       "+s(this.pos)+" ^\n             line num: "+this.lineNum+"\n                  pos: "+this.pos+"\n                extra: "+JSON.stringify(this.extra)+"\n        }\n    ")},t["default"]=i},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=(n(3),function(){function e(t,n){i(this,e),this._depth=t,this._nodes=n,this.rv=void 0,this.value=void 0,this.lastValue=void 0}return r(e,[{key:"exec",value:function(e,t,n,i){var r=this._nodes.length,o=0;for(this.rv=null!=t?t:e&&e.rv,this.value=null!=n?n:e&&e.lastValue,this.lastValue=null!=i?i:this.value;r>o;o++)this._nodes[o].exec(this)}}]),e}());t["default"]=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e){var t,n,i=new u["default"](e),r=i.getToken();if(r.type!==f["default"].CONTEXT)throw new s["default"](r.type,f["default"].CONTEXT,"Leading context token not found.");if(t=new _["default"](r.end,i.getToken.bind(i)),n=t.parse(),t.destroy(),n.endTok)throw new s["default"](r,"EOF");return n.node}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=r;var o=n(6),s=i(o),a=n(22),u=i(a),l=n(4),f=i(l),c=n(5),_=i(c)},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){return e instanceof v["default"]?e:(0,v["default"])(e)}function s(e){return function(t){return o(t).find(e)}}function a(e){var t=parseInt(e,10);return function(e){return o(e).eq(t)}}function u(e){return o(e).text()}function l(e){return function(t){return o(t).attr(e)}}function f(e){var t=[],n=e.nextToken();if(!n)throw new d["default"]("Expected to find a "+y["default"].INDEX_ACCESSOR+", "+y["default"].ATTR_ACCESSOR+" or "+y["default"].TEXT_ACCESSOR+" token");if(n.type===y["default"].INDEX_ACCESSOR){if(t.push(a(n.content)),n=e.nextToken(),!n)throw new d["default"]("Expected to find a "+y["default"].QUERY_STATEMENT_END+" or "+y["default"].TEXT_ACCESSOR+" token");if(n.type===y["default"].QUERY_STATEMENT_END)return t}if(n.type===y["default"].TEXT_ACCESSOR)t.push(u);else{if(n.type!==y["default"].ATTR_ACCESSOR){var i=[y["default"].TEXT_ACCESSOR,y["default"].ATTR_ACCESSOR];throw t.length||i.push(y["default"].INDEX_ACCESSOR),new T["default"](n.type,i,n)}var r=n.content.trim().slice(1,-1);t.push(l(r))}var o=e.nextToken();if(!o)throw new d["default"]("Expected to find a "+y["default"].QUERY_STATEMENT_END+" token");if(o.type!==y["default"].QUERY_STATEMENT_END)throw new T["default"](o.type,y["default"].QUERY_STATEMENT_END,o);return t}function c(e){if(!e._tok)throw new d["default"]("Expected to find a token, instead found EOF");var t=e._tok.content.trim(),n=s(t),i=e.nextToken();if(!i)throw new d["default"]("Expected to find a "+y["default"].QUERY_STATEMENT_END+" or "+y["default"].ACCESSOR_SEQUENCE+" token");if(i.type===y["default"].QUERY_STATEMENT_END)return[n];if(i.type===y["default"].ACCESSOR_SEQUENCE)return[n].concat(f(e));throw new T["default"](i.type,[y["default"].QUERY_STATEMENT_END,y["default"].ACCESSOR_SEQUENCE],i)}var _=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=n(9),d=i(h),E=n(6),T=i(E),p=(n(3),n(10)),v=i(p),S=n(5),C=(i(S),n(4)),y=i(C),N=n(1),w=(i(N),function(){function e(t){r(this,e),this._queries=t}return _(e,[{key:"exec",value:function(e){if(!e)throw new Error("Invalid context, expected to find a context for a query node");for(var t=e.value,n=this._queries.length,i=0;n>i;i++)t=this._queries[i](t);e.lastValue=t}}]),e}());t.parse=function(e){var t,n=e.nextToken();if(!n)throw new d["default"]("Expected to find a "+y["default"].CSS_SELECTOR+" or "+y["default"].ACCESSOR_SEQUENCE+" token");if(n.type===y["default"].CSS_SELECTOR)t=c(e);else{if(n.type!==y["default"].ACCESSOR_SEQUENCE)throw new T["default"](n.type,[y["default"].CSS_SELECTOR,y["default"].ACCESSOR_SEQUENCE],n);t=f(e)}return new w(t)}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(18),a=i(s),u=n(1),l=i(u),f=n(4),c=i(f),_=Object.freeze({COMMENT_TEST:/^\s*#.*$/,CONTEXT_WS:/\S/,INT:/^-?\d+/g,ALPHA:/[a-zA-Z]/}),h=Object.freeze({CSS_START:"$",ACCESSOR_START:"|",ATTR_ACCESSOR_START:"[",ATTR_ACCESSOR_END:"]",TEXT_ACCESSOR:"text",OWN_TEXT_ACCESSOR:"text",FIELD_ACCESSOR_START:".",STATEMENT_END:";",PARAMS_START:":",CONTINUATION:","}),d=Object.freeze({QUERY_START:h.CSS_START+h.ACCESSOR_START,CSS_STATEMENT_END:h.ACCESSOR_START+h.STATEMENT_END,DIRECTIVE_ID_END:h.PARAMS_START+h.STATEMENT_END,PARAM_END:" "+h.STATEMENT_END+h.CONTINUATION}),E=function(){function e(t){r(this,e),this._lines=t,this._numLines=t.length,this._line=void 0,this._lineNum=0,this._start=0,this._pos=0,this._nextScan=[],this._isDone=!1}return o(e,[{key:"isDone",value:function(){return this._isDone}},{key:"_getC",value:function(){return this._line?this._line[this._pos]:void 0}},{key:"_getEol",value:function(){return!this._line||this._pos>=this._line.length}},{key:"_getToEolContent",value:function(){if(null==this._line)throw new a["default"]("Unexpected empty line",this._line,this._lineNum,this._pos);return this._line.slice(this._start)}},{key:"_getTokenContent",value:function(){if(null==this._line)throw new a["default"]("Unexpected empty line",this._line,this._lineNum,this._pos);return this._line.slice(this._start,this._pos)}},{key:"getToken",value:function(){var e,t;if(!this._isDone){if(e=this._nextScan[0],this._nextScan[0]=void 0,!e){if(t=this._nextLine(),!t)return void(this._isDone=!0);e=this._scanContext}return e.call(this)}}},{key:"_nextLine",value:function(){if(this._lineNum>=this._numLines)return!1;for(;this._lineNum<this._numLines&&(this._line=this._lines[this._lineNum].replace(/\s+$/,""),this._lineNum+=1,this._start=this._pos=0,!this._line.length||_.COMMENT_TEST.test(this._line));)this._line=void 0;return!!this._line}},{key:"_ignore",value:function(){this._start=this._pos}},{key:"_makeToken",value:function(e){var t=this._line;if(null==t)throw new a["default"]("Unexpected `== null` line",t,this._lineNum,this._pos);var n=new l["default"](e,this._getTokenContent(),t,this._lineNum,this._start,this._pos);return this._start=this._pos,n}},{key:"_makeMarkerToken",value:function(e){if(null==this._line)throw new a["default"]("Unexpected `== null` line",this._line,this._lineNum,this._pos);return new l["default"](e,"",this._line,this._lineNum,this._start,this._start)}},{key:"_accept",value:function(e,t){var n;return this._getEol()?!1:(n=this._getC(),e&&n&&e.indexOf(n)>-1?(this._pos+=1,!0):t&&n&&_.ALPHA.test(n)?(this._pos+=1,!0):!1)}},{key:"_acceptRun",value:function(e){for(var t=0,n=this._getC();!this._getEol()&&n&&e.indexOf(n)>-1;)t+=1,this._pos+=1,n=this._getC();return t}},{key:"_acceptUntil",value:function(e){for(var t=0,n=this._getC();!this._getEol()&&n&&e.indexOf(n)<0;)t+=1,this._pos+=1,n=this._getC();return t}},{key:"_consume",value:function(e){var t=this._line;if(null==t)throw new a["default"]("Unexpected `== null` line",t,this._lineNum,this._pos);if(this._getEol())return!1;var n=this._pos+e.length;return t.slice(this._pos,n)===e?(this._pos=n,!0):!1}},{key:"_consumeRegex",value:function(e){if(!e.global)throw new Error("testRx parameter should have the global flag");if(this._getEol())return!1;var t=e.exec(this._getToEolContent());return t?0!==t.index?(e.lastIndex=0,!1):(this._pos+=e.lastIndex,e.lastIndex=0,!0):!1}},{key:"_scanContext",value:function(){if(null==this._line)throw new a["default"]("Invalid state: error parsing context",this._line,this._lineNum,this._pos);if(this._pos=this._line.search(_.CONTEXT_WS),this._pos<0)throw new a["default"]("Invalid state: error parsing context",this._line,this._lineNum,this._pos);return this._nextScan[0]=this._scanStatement,this._makeToken(c["default"].CONTEXT)}},{key:"_scanStatement",value:function(){var e=this._getC();if(null==e)throw new a["default"]("Error scanning statement",this._line,this._lineNum,this._pos,e);var t=d.QUERY_START.indexOf(e)>-1;return t?(this._nextScan[0]=this._scanQuery,this._makeMarkerToken(c["default"].QUERY_STATEMENT)):(this._nextScan[0]=this._scanDirective,this._makeMarkerToken(c["default"].DIRECTIVE_STATEMENT))}},{key:"_scanDirective",value:function(){if(this._accept(h.PARAMS_START))return this._nextScan[0]=this._scanDirectiveBody,this._makeToken(c["default"].DIRECTIVE_IDENTIFIER);if(this._acceptUntil(d.DIRECTIVE_ID_END)<1)throw new a["default"]("Invalid directive, 0 length: "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos);var e=this._makeToken(c["default"].DIRECTIVE_IDENTIFIER),t=this._getC();if(this._getEol()||t===h.STATEMENT_END)return this._nextScan[0]=this._endDirective,e;if(this._accept(":"))return this._ignore(),this._nextScan[0]=this._scanDirectiveBody,e;throw new a["default"]("Invalid directive identifier terminator: "+JSON.stringify(t)+'. Either "'+h.PARAMS_START+'", "'+h.STATEMENT_END+'" or end of line required.',this._line,this._lineNum,this._pos)}},{key:"_scanDirectiveBody",value:function(){this._acceptRun(" "),this._ignore();var e=this._getC();if(this._getEol()||e===h.STATEMENT_END)return this._endDirective();if(e===h.CONTINUATION){if(this._accept(h.CONTINUATION),this._acceptRun(" "),this._ignore(),this._getEol()&&!this._nextLine())throw new a["default"]("Unexpected EOF, directive parameter expected.",this._line,this._lineNum,this._pos);this._consumeRegex(/\s+/)}if(this._acceptUntil(d.PARAM_END)<1)throw new a["default"]("Invalid directive body item, 0 length",this._line,this._lineNum,this._pos);return this._nextScan[0]=this._scanDirectiveBody,this._makeToken(c["default"].DIRECTIVE_BODY_ITEM)}},{key:"_endDirective",value:function(){var e=this._makeMarkerToken(c["default"].DIRECTIVE_STATEMENT_END);if(this._getEol())return e;if(this._getC()===h.STATEMENT_END)return this._nextScan[0]=this._scanInlineSubContext,e;throw new a["default"]("Invalid end of directive statement: "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos)}},{key:"_scanQuery",value:function(){var e=this._getC();if(e===h.CSS_START)return this._scanCSSSelector();if(e===h.ACCESSOR_START)return this._scanAccessorSequence();throw new a["default"]("Invalid query statement: "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos)}},{key:"_scanCSSSelector",value:function(){if(this._accept(h.CSS_START),this._acceptRun(" "),this._ignore(),this._acceptUntil(d.CSS_STATEMENT_END)<1)throw new a["default"]("Invalid CSS Selector: "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos);var e=this._makeToken(c["default"].CSS_SELECTOR),t=this._getC();if(this._getEol()||t===h.STATEMENT_END)this._nextScan[0]=this._endQueryStatement;else{if(t!==h.ACCESSOR_START)throw new a["default"]("EOL or accessor sequence expected, instead found "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos);this._nextScan[0]=this._scanAccessorSequence}return e}},{key:"_endQueryStatement",value:function(){var e=this._makeMarkerToken(c["default"].QUERY_STATEMENT_END);if(this._getEol())return e;if(this._getC()===h.STATEMENT_END)return this._nextScan[0]=this._scanInlineSubContext,e;throw new a["default"]("Invalid end of query statement "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos)}},{key:"_scanAccessorSequence",value:function(){var e=this._makeMarkerToken(c["default"].ACCESSOR_SEQUENCE);return this._accept(h.ACCESSOR_START),this._ignore(),this._nextScan[0]=this._scanAccessor,e}},{key:"_scanAccessor",value:function(){this._acceptRun(" "),this._ignore();var e=this._getC();if(this._getEol()||e===h.STATEMENT_END)return this._endQueryStatement();if(e===h.ATTR_ACCESSOR_START){var t=this._acceptUntil(h.ATTR_ACCESSOR_END)<1;if(t=t||!this._accept(h.ATTR_ACCESSOR_END))throw new a["default"]("Invalid attribute selector: "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos);return this._nextScan[0]=this._scanAccessor,this._makeToken(c["default"].ATTR_ACCESSOR)}if(this._consume(h.TEXT_ACCESSOR))return this._nextScan[0]=this._scanAccessor,this._makeToken(c["default"].TEXT_ACCESSOR);if(this._consumeRegex(_.INT))return this._nextScan[0]=this._scanAccessor,this._makeToken(c["default"].INDEX_ACCESSOR);throw new a["default"]("Expected an accessor, instead found: "+JSON.stringify(this._getToEolContent()),this._line,this._lineNum,this._pos)}},{key:"_scanInlineSubContext",value:function(){this._accept(";");var e=this._makeToken(c["default"].INLINE_SUB_CONTEXT);return this._acceptRun(" "),this._ignore(),this._nextScan[0]=this._scanStatement,e}}]),e}();t["default"]=E},function(e,t,n){"use strict";function i(e){var t=void 0;t="string"==typeof e?[e]:e.raw;for(var n="",i=arguments.length,r=Array(i>1?i-1:0),o=1;i>o;o++)r[o-1]=arguments[o];for(var s=0;s<t.length;s++)n+=t[s].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),s<r.length&&(n+=r[s]);n=n.trim();var a=n.split("\n"),u=null;return a.forEach(function(e){var t=e.match(/^ +/);if(t){var n=t[0].length;u=u?Math.min(u,n):n}}),null!==u&&(n=a.map(function(e){return" "===e[0]?e.slice(u):e}).join("\n")),n.replace(/\\n/g,"\n")}e.exports=i}])});